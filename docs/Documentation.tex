\documentclass[12pt,             % Schriftgroesse
               a4paper,          % Papierformat
               %liststotoc,      % (alt) Tabellen- und Abbildungsverzeichnis im Inhaltsverz.
               listof=totoc,     % Tabellen- und Abbildungsverzeichnis im Inhaltsverz.
               %idxtotoc,        % (alt) Index im Inhaltsverz. auffuehren
               index=totoc,      % Index im Inhaltsverz. auffuehren
               %bibtotoc,        % (alt) Literaturverzeichnis im Inhaltsverz. auffuehren
               bibliography=totoc,% Literaturverzeichnis im Inhaltsverz. auffuehren
               oneside,         % auskommentieren, wenn beidseitig gedruckt wird
                                 % default ist 'twoside'
               BCOR1cm,          % zusaetzlicher Bindungsrand
               english   %  Englisch als weitere Sprache, Deutsch als Hauptsprache
               ]{scrbook}

\usepackage[utf8]{inputenc}  
\usepackage[T1]{fontenc}
\usepackage{lmodern}         
%\usepackage{eurosym}  
\usepackage[ngerman]{babel}
\usepackage{graphicx}
\usepackage[left=20mm, right=20mm, top=25mm]{geometry}
\usepackage{listings} \lstset{numbers=left, numberstyle=\tiny, numbersep=5pt, basicstyle =\footnotesize} 
\lstset{language=ruby}
\usepackage{url}
\setlength\parindent{0pt} 
\usepackage{float}

\usepackage{hyperref}
\linespread{1.3}
\usepackage{multicol}
\usepackage[german]{varioref}

\bibliographystyle{alphadin}

\setcounter{tocdepth}{1}

\usepackage[]{acronym}

\title{Testdriven Development am Beispiel der o/zb Webapplikation}
\author{Martin Briewig, Michael Leibel}


\begin{document}

\pagestyle{empty}
\begin{center}

\begin{figure}[h]
	\begin{center}
		\includegraphics[width=0.70\textwidth]{\string"Media/hskalogo\string".jpg}
	\end{center}
	\label{fig:hska_logo}
\end{figure} 

\vspace{5\baselineskip}

\textsc{\Huge Test-Driven Development\\ mit Ruby on Rails}\\[0.25cm]
\textsc{\large am Beispiel der o/ZB Webapplikation}\\[1.5cm]


\vspace{2\baselineskip}

\textsc{\LARGE Projektarbeit}\\[1.5cm]


\vspace{5\baselineskip}

vorgelegt von\\
Briewig, Martin, B.Sc. (Matr.-Nr.: 43509)\\
Leibel, Michael, B.Sc. (Matr.-Nr.: 43674)

\vspace{\baselineskip}

Betreuer: Prof. Dr. Frank Schaefer

Fachbereich: Informatik (Master)
\end{center}

\clearpage{}

\pagenumbering{roman} 

\tableofcontents{}

\clearpage{}

%\addcontentsline{toc}{section}{Abkürzungsverzeichnis}
\chapter*{Abkürzungsverzeichnis}

\begin{acronym}[SQL]
	\acro{AP}{Arbeitspaket}
	\acro{o/ZB}{Ohne Zins Bewegung}
     \acro{RoR}{Ruby on Rails}
\end{acronym}

\newpage

\pagenumbering{arabic} 
\chapter{Einleitung}
Die ohne Zins Bewegung Stuttgart arbeitet nun seit einigen Jahren mit der Hochschule Karlsruhe zusammen an einer Webanwendung. Diese Webanwendung soll die Geschäftsprozesse der Bewegung unterstützen und verwalten. Im Laufe der letzten Jahre ist aus der ursprünglichen Idee eine komplexe Webanwendung entstanden, die nun gründlich auf Fehler überprüft und gegebenfalls ausgebessert werden soll. 
Diese Aufgabe wird nun uns, Herr Briewig und Herr Leibel, anvertraut. Im Folgenden wird eine detaillierte Aufgabenstellung formuliert, an dieser sich diese Projektarbeit messen lassen wird.  

\section{Aufgabenbeschreibung}
Die Aufgaben dieser Projektarbeit sind recht vielfältig. Sie lassen sich in 3 Phasen einteilen. Darüber hinaus gibt es für jede Phase ein Zeitlimit von etwa 3 Wochen.

\subsection{Phase 1: Korrekturen, Dokumentieren}
\textbf {(Duedate: 02.05.2013)}\\
% Korrekturen am ER Diagramm/Relationenmodell
%    -    ER Diagramm soll der Implementierung entsprichen
%    -    Darstellung aller PKs und FKs für den nicht historisierten Fall
Die erste Phase wird von den Korrekturen am ER-Diagramm und dem dazugehörigen Relationsmodell dominiert. Das ER-Diagramm weißt noch ein paar Unstimmigkeiten auf, die im Laufe der Zeit entstanden sind. Diese gilt es zu bereinigen und die vorgenommenen Korrekturen in der Implementierung umzusetzen. Ziel ist ein ER-Diagramm, welches den nicht-historisierten Zustand darstellt. Dieses ER-Diagramm soll 1:1 in der Implementierung vorzufinden zu sein. Es soll vereinfacht dargestellt werden, lediglich die Primär- und Fremdschlüssel sollen den Entitäten als Zusatzinformationen dienen.\\

% Dokumentieren:
%    -    DB-Migration, wie geht das?
%    -    Deployment, wie funktioniert das?
Neben den Korrekturen am ER-Diagramm sind Dokumentationen der Vorgehens- und Funktionsweise des Datenbank Migrationstools notwendig. Hierfür sind zwei Batch-Skripte angefertigt worden, deren Nutzungs- und Funktionsweisen zu dokumentieren sind.\\

Im Laufe der Zeit sind die verschiedensten Techniken zur Bereitstellung und Versionierung der o/zb Webanwendung verwendet worden. Es gilt nun, einen einheitlichen Vorgang zu definieren der für die nachfolgenden Projektgruppen verwendet werden soll. Basierend auf der anzufertigten Dokumentation, kann die Bereitstellung und Versionierung stetig verbessert werden.\\

% Allgemeine Korrekturen:
%    -    WebImport
Zusätzlich soll in dieser Phase ein kritischer Fehler bereinigt werden. Der WebImport, welcher für den Import der Kontobewegungen verantwortlich ist, arbeitet nicht richtig. Zur Zeit ist der Datei-Upload auf dem Testsystem nicht möglich. Darüber hinaus kommt es bei einer lokalen Testumgebung zu Laufzeitfehlern. Auch die im Webfrontend angezeigte Anzahl der importierten Datensätze ist nicht korrekt.

\subsection{Phase 2: Korrektur der Punkteberechnung, Word Export}
\textbf {(Duedate: 23.05.2013)}\\
% Allgemeine Korrekturen:
%    -    Korrektur der Punkteberechnung
% Feature:
%    -    Dokumente (Word,PDF) generieren

\subsection{Phase 3: Einrichtung Testdriven Development}
\textbf {(Duedate: 13.06.2013)}\\
% Tests
%    -    Beschreibung der Testumgebung mit Sublime 2(?) und RSpec
%    -    Testfälle entwickeln


\clearpage
\chapter{Hintergrundwissen}
\section{Das o/ZB Projekt}

\section{Das Testsystem}\label{sec:Das_Testsystem}
% URL, Maschine, Versionen... 

\section{Test-Driven Development}
\subsection{Definition}
\subsection{Unit-Tests}
\subsection{Functional-Tests}
\subsection{Integration-Tests}

\section{o/ZB Darlehensvertrag}
% Wie sieht der aus?

\clearpage
\chapter{Allgemeine Dokumentationen}
\section{Das korrigierte ER-Diagramm}
% Wie sieht es aus?
% Was wurde angepasst?
% Beschreibung der Veränderungen am Code

\section{Das korrigierte Relationenmodell}
% Darstellung des ER-Diagramms in Tabellenform

\section{Deployment und Versionskontrolle}
In diesem Abschnitt werden die Begriffe \textit{Deployment} und \textit{Versionskontrolle} erläutert. In jedem Teilabschnitt wird die aktuelle Umsetzung beschrieben. Der letzte Teil dieses Abschnitts beschäftigt sich mit dem \textit{Commit \& Deployment Workflow}.

\subsection{Deployment}
% Was ist das? Deployment - Capistrano, Versionskontrolle - Git
In der Softwareentwicklung wird unter dem Begriff \textit{Deployment} der Prozess zur \textit{Bereitstellung} und \textit{Verteilung} einer Software verstanden. Der Prozess ist von Software zu Software unterschiedlich, da z.B. die Konfiguration einer Software immer an die Umgebung angepasst werden muss, in der diese zum Einsatz kommt.\\

Im Falle der o/zb muss der Deployment Prozess die Bereitstellung der o/zb Webanwendung auf einem Server bewerkstelligen. Dies wirft die folgenden Fragen auf: Welcher Webserver wird eingesetzt? Wie gelangt die RoR Webanwendung auf den Server? Und wie arbeiten Anwendungsserver und Webserver auf dem Server zusammen? Diese Fragen werden die nun folgenden Teilabschnitte (kurz) klären.

\subsubsection{Webserver - Apache}
Ein Webserver überträgt Daten an einen Client. Dabei kann dieser die Daten nur lokal oder auch weltweit zur Verfügung stellen. Er dient im Falle der o/zb Webanwendung dazu, die von RoR erzeugten Webseiten an den Clienten auszuliefern. Dies geschieht sobald er die Anfrage eines Clienten aufgenommen und an die RoR Anwendung weitergeleitet hat. Daraufhin verarbeitet die RoR Anwendung diese Anfrage und liefert dem Webserver das Ergebnis zurück. Der Webserver sendet nun diese Daten an den Clienten.\\

Auf dem Testsystem der o/zb (s. \vref{sec:Das_Testsystem}) kommt ein Apache Webserver in der Version 2.2.16 zum Einsatz. Auf dem Testsystem laufen bis zu vier Apache Instanzen gleichzeitig, um die Anfragen der Benutzer bedienen zu können. Weitere Informationen zum Apache Webserver sind unter der Adresse \url{http://www.apache.org} erreichbar.

\subsubsection{Anwendungsserver - Phusion Passenger}
Ein \textit{Anwendungsserver} bietet einer Anwendung die benötigte Laufzeitumgebung, damit diese auch ausgeführt werden kann. Dazu stellt der Anwendungsserver der Anwendung spezielle Dienste zur Verfügung, die die Anwendung zur Ausführung benötigt.\\
Im Fall der o/zb Webanwendung wird der weit verbreitete und leistungsstarke \textit{Phusion Passenger} Anwendungsserver in der Version 3.0.19 genutzt. Phusion Passenger ist ein Modul für den Apache Webserver und ist als ein sogenanntes \textit{RubyGem} (entspricht etwa einem Softwarepaket speziell für Ruby) verfügbar. Zudem ist es auch unter dem Namen \textit{mod\_rails} oder \textit{mod\_rack} bekannt. Weitere Informationen können auf der Webseite von Phusion \url{https://www.phusionpassenger.com/} entnommen werden. \footnote{vgl. \url{http://de.wikipedia.org/wiki/Phusion_Passenger}}

\subsubsection{Capistrano}
Wie Eingangs dieses Abschnittes erwähnt worden ist, sind bei einem Deployment Prozess die Schritte notwendig, die die Bereitstellung der Software bewerkstelligen. Diese Schritte müssen nicht immer manuell ausgeführt werden, sondern können automatisiert werden. Dafür eignet sich im Falle der o/zb Webanwendung die Software \textit{Capistrano}. Diese Software ist ein Open Source Werkzeug, das (Batch-) Skripte auf Servern, z.B. mit der Hilfe einer \textit{Secure Shell (SSH)}, ausführt. Dem zur Folge ist ihr Haupteinsatzzweck in der Softwareverteilung wiederzufinden. Capistrano ist genauso wie die o/zb Webanwendung auch in Ruby geschrieben und als RubyGem verfügbar. \footnote{vgl. \url{http://de.wikipedia.org/wiki/Capistrano_(Software)}}\\

Bei Capistrano bestimmen sogenannte Deployment Rezepte (\glqq Deployment Recipies\grqq) wie der Deployment Prozess verläuft. Auch für die o/zb Webanwendung wurde ein Rezept geschrieben, welches im Abschnitt \vref{subsec:deployment_recipe} beschrieben wird.

\subsection{Versionsverwaltung}
Für einen stabilen und guten Softwareentwicklungsprozess ist eine Versionsverwaltung in der heutigen Zeit unabdingbar. Die Hauptaufgaben bestehen aus der Protokollierung der vorgenommenen Änderungen an Quelltexten, Skripten und anderen Dokumenten. Der Wiederherstellung von alten Zuständen, sodass versehentliche Änderungen oder Änderungen, die z.B. zu Laufzeitfehlern führten, zurückgenommen werden können. Die Archivierung jedes neuen Proejktzustands. Die Koordinierung des gemeinsamen Datei-Zugriffs der am Projekt beteiligten Entwickler. Und zu guter Letzt ermöglicht eine Versionsverwaltung die gleichzeitige Erzeugung mehrerer Entwicklungszweige (sogenannter \glqq Branches\grqq) eines Projektes. \footnote{vgl. \url{http://de.wikipedia.org/wiki/Versionsverwaltung}}

\subsubsection{Git}
% Wie sieht aktuelle Setup aus?
Für das Projekt der o/zb Stuttgart wird die weit verbreitete, freie Software \textit{Git} verwendet. Es wurde ursprünglich für die Quelltext-Verwaltung des Linux Kernels entwickelt.\\
Git ist im Gegensatz zu den Traditionellen Versionsverwaltungen wie z.B. \textit{SVN} oder \textit{Mercurial} ein verteiltes Versionsverwaltungssystem. Es gibt keinen zentralen Server auf dem das Projekt gespeichert wird, sodass jeder Entwickler eine lokale Kopie des gesamten Repositorys vorliegen hat - \textit{clone}. Dem zur Folge hat der Entwickler die Möglichkeit auch ohne Netzwerkzugriff die einzelnen Zustände seiner Arbeit festzuhalten - \textit{commit}. Besteht wieder ein Netzwerkzugriff kann er seine Änderungen auf das von den Entwicklern gemeinsam genutztes Projekt-Depot (\textit{Repository}) hochladen - \textit{push}. Zuvor muss er sich jedoch mit dem gemeinsamen Repository wieder synchronisieren - \textit{pull}. \footnote{vgl. \url{http://de.wikipedia.org/wiki/Git}}\\

Das aktuelle, gemeinsame Repository des o/zb Projektes wird von dem bekannten Git-Hoster \textit{GitHub} bereitgestellt. Die Adresse zum Repository lautet: \url{https://github.com/Avenel/FirstApp}.

\subsection{Workflow, Umsetzung}
% Workflow: Git add/commit/push, cap deploy
In diesem Teilabschnitt werden die vorher erläuterten Konzepte \textit{Deployment} und \textit{Versionsverwaltung} in Zusammenhang gebracht. Es wird ein simpler Arbeitsablauf (\glqq Workflow\grqq) defininert, der den Deployment Prozess beschreibt. Dieser Arbeitsablauf wird in Abbildung \vref{fig:deployment_workflow} dargestellt.

\begin{figure}[H]
     \begin{center}
          \includegraphics[width=0.90\textwidth]{\string"Media/Deployment Workflow\string".pdf}
     \end{center}
     \caption{Der Deployment Workflow}
     \label{fig:deployment_workflow}
\end{figure} 

Möchte der Entwickler seine Arbeit auf dem Server bereitstellen, ist er angehalten sich den aktuellen Projektstatus aus dem gemeinsamen Repository zu holen. Er ist dafür verantwortlich sein Projekt vor jedem Commit auf den neuesten Stand zu bringen. Dies geschieht mit der Anweisung \textit{git pull}. Kommt es zu (Datei-) Konflikten die Git nicht automatisch selber lösen kann, muss der Entwickler selber eingreifen (\textit{merge}). Er wiederholt diesen Vorgang solange, bis sein Projekt konfliktfrei und auf dem neuesten Stand ist. Erst dann kann er ausgewählte Änderungen am Projekt für einen neuen \textit{Commit} hinzufügen (\textit{git add}). Im Anschluss schließt er den Commit-Prozess mit dem Befehl \textit{git commit -am "Kommentar"} ab. Damit auch das gemeinsame Repository den aktuellsten Stand gebracht wird, erfolgt der Befehl \textit{git push}. Dieser lädt die neuesten Änderungen hoch.\\

Wurde das gemeinsame Repository nun auf den neuesten Stand gebracht, kann der letzte Schritt im Deployment Workflow durchgeführt werden. Mit \textit{cap deploy} wird das, im nächsten Abschnitt beschriebene, Deploymentskript ausgeführt. 

\subsubsection{Das Capistrano Deploymentskript (Rezept)}\label{subsec:deployment_recipe}

\begin{lstlisting}[frame=single, caption=Capistranot Deployment Rezept, tabsize=2, flexiblecolumns=true, captionpos=b]{Deploy.rb}
set :application, "ozbapp"

server "188.64.45.50", :web, :app, :db, :primary => true

set :scm, "git"
set :repository, "https://github.com/Avenel/FirstApp.git"
set :branch, "master"

set :user, "ozbapp"
set :deploy_to, "/home/#{user}/apps/#{application}"
set :deploy_via, :remote_cache
set :use_sudo, false

ssh_options[:forward_agent] = true

namespace :deploy do

     desc "Tell Passenger to restart the app."
     task :restart do
          run "touch #{current_path}/ozbapp/tmp/restart.txt"
     end

     desc "Renew SymLink"
     task :renew_symlink do
          run "rm /home/ozbapp/ozbapp"
          run "ln -s /home/ozbapp/apps/ozbapp/current/ozbapp /home/ozbapp/ozbapp"
     end

end

after 'deploy:update_code', 'deploy:renew_symlink'
\end{lstlisting}


\section{Datenbank Migration}
% Welche Skript gibt es und was tun diese?
% Wie wird das auf dem Server ausgeführt?

\clearpage
\chapter{Korrekturen, Bugfixes}
% WebImport
\section{WebImport}

% Punkteberechnung
\section{Punkteberechnung}

\clearpage
\chapter{Testdriven Development}
\section{Analyse}
% Ist-Analyse: Es gibt keine Tests, Fehlerbehaftete Anwendung
% Soll-Analyse: bugfrei durch TDD. Was müssen wir dafür testen?
% Auswertung der bisherigen manuellen Tests
% Implementierte Geschäftsprozesse verstehen (für die spätere Entwicklung der Tests)
% Vorgehensweise
\section{Implementierung}
\subsection{RSpec}

\chapter{Neue Features}
\section{Dokumenten-Export}
\subsection{Analyse}
% Was muss in den Darlehensvertrag? s.Hintergrundwissen
% Muss er noch im Nachhinein verändert werden? -> Word oder PDF?
\subsection{Implementierung}
\clearpage


\chapter{Ergebnis und Ausblick}
\section{Ergebnis}
\section{Ausblick}

\clearpage
\chapter{Anhang}

\newpage
%\addcontentsline{toc}{chapter}{Abbildungsverzeichnis}
\listoffigures

\newpage
%\addcontentsline{toc}{chapter}{Tabellenverzeichnis}
\listoftables

\newpage
%\addcontentsline{toc}{chapter}{Listingsverzeichnis}
\lstlistoflistings

\newpage
%\addcontentsline{toc}{chapter}{Literatur}
\bibliography{sources}

\end{document}

